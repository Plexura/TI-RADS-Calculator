<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ACR TI-RADS Calculator by Plexura</title>

  <!-- ✅ Working favicon setup -->
  <link rel="icon" href="./favicon.png?v=20" type="image/png" />
  <link rel="apple-touch-icon" href="./favicon.png?v=20" />
  <meta name="theme-color" content="#2563eb" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    body { font-family: "Inter", sans-serif; }
    input[type="radio"], input[type="checkbox"] { display: none; }
    input:checked + label {
      border-color: #2563eb;
      background-color: #eff6ff;
    }
    fieldset:disabled { opacity: 0.6; pointer-events: none; }
  </style>
</head>

<body class="bg-gray-100 p-4 md:p-8">
  <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
    <div class="p-6 md:p-10 border-b border-gray-200 text-center">
      <img src="./plexura-logo.png" alt="Plexura Logo" class="w-20 h-20 mx-auto mb-3 rounded-full shadow-sm" />
      <h1 class="text-3xl font-bold text-gray-800">ACR TI-RADS Calculator</h1>
      <p class="text-sm text-gray-500 mt-1">by <strong>Plexura</strong></p>
      <p class="mt-2 text-sm md:text-base text-gray-600">
        A simple, accurate tool for thyroid nodule classification based on ACR TI-RADS 2017.
      </p>
    </div>

    <div class="md:grid md:grid-cols-3">
      <!-- LEFT: Inputs -->
      <form id="tirads-form" class="md:col-span-2 p-6 md:p-8 space-y-6">
        <!-- Composition -->
        <fieldset id="composition-group" class="space-y-3">
          <legend class="text-lg font-semibold text-gray-900 mb-2">1. Composition</legend>
          <div><input type="radio" id="comp-0" name="composition" value="0" data-text="Cystic or completely cystic" checked><label for="comp-0" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Cystic or completely cystic (0)</label></div>
          <div><input type="radio" id="comp-1" name="composition" value="0" data-text="Spongiform"><label for="comp-1" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Spongiform (0)</label></div>
          <div><input type="radio" id="comp-2" name="composition" value="1" data-text="Mixed cystic and solid"><label for="comp-2" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Mixed cystic and solid (1)</label></div>
          <div><input type="radio" id="comp-3" name="composition" value="2" data-text="Solid or almost completely solid"><label for="comp-3" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Solid or almost completely solid (2)</label></div>
        </fieldset>

        <!-- Echogenicity -->
        <fieldset id="echogenicity-group" class="space-y-3">
          <legend class="text-lg font-semibold text-gray-900 mb-2">2. Echogenicity</legend>
          <div><input type="radio" id="echo-0" name="echogenicity" value="0" data-text="Anechoic" checked><label for="echo-0" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Anechoic (0)</label></div>
          <div><input type="radio" id="echo-1" name="echogenicity" value="1" data-text="Isoechoic or Hyperechoic"><label for="echo-1" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Isoechoic / Hyperechoic (1)</label></div>
          <div><input type="radio" id="echo-2" name="echogenicity" value="2" data-text="Hypoechoic"><label for="echo-2" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Hypoechoic (2)</label></div>
          <div><input type="radio" id="echo-3" name="echogenicity" value="3" data-text="Very hypoechoic"><label for="echo-3" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Very hypoechoic (3)</label></div>
        </fieldset>

        <!-- Shape -->
        <fieldset id="shape-group" class="space-y-3">
          <legend class="text-lg font-semibold text-gray-900 mb-2">3. Shape (Transverse)</legend>
          <div><input type="radio" id="shape-0" name="shape" value="0" data-text="Wider than tall" checked><label for="shape-0" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Wider than tall (0)</label></div>
          <div><input type="radio" id="shape-1" name="shape" value="3" data-text="Taller than wide"><label for="shape-1" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Taller than wide (3)</label></div>
        </fieldset>

        <!-- Margin -->
        <fieldset id="margin-group" class="space-y-3">
          <legend class="text-lg font-semibold text-gray-900 mb-2">4. Margin</legend>
          <div><input type="radio" id="margin-0" name="margin" value="0" data-text="Smooth" checked><label for="margin-0" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Smooth (0)</label></div>
          <div><input type="radio" id="margin-1" name="margin" value="0" data-text="Ill-defined"><label for="margin-1" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Ill-defined (0)</label></div>
          <div><input type="radio" id="margin-2" name="margin" value="2" data-text="Lobulated / Irregular"><label for="margin-2" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Lobulated / Irregular (2)</label></div>
          <div><input type="radio" id="margin-3" name="margin" value="3" data-text="Extra-thyroidal extension"><label for="margin-3" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Extra-thyroidal extension (3)</label></div>
        </fieldset>

        <!-- Echogenic Foci -->
        <fieldset id="foci-group" class="space-y-3">
          <legend class="text-lg font-semibold text-gray-900 mb-2">5. Echogenic Foci</legend>
          <div><input type="checkbox" id="foci-0" name="foci" value="0" data-type="none" data-text="None" checked><label for="foci-0" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">None (0)</label></div>
          <div><input type="checkbox" id="foci-1" name="foci" value="1" data-type="point" data-text="Macrocalcifications"><label for="foci-1" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Macrocalcifications (1)</label></div>
          <div><input type="checkbox" id="foci-2" name="foci" value="2" data-type="point" data-text="Rim calcifications"><label for="foci-2" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Rim calcifications (2)</label></div>
          <div><input type="checkbox" id="foci-3" name="foci" value="3" data-type="point" data-text="Punctate echogenic foci"><label for="foci-3" class="block p-4 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-50">Punctate echogenic foci (3)</label></div>
        </fieldset>

        <button type="button" id="reset-button" class="w-full px-6 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700">Reset</button>
      </form>

      <!-- RIGHT: Results -->
      <div class="md:col-span-1 bg-gray-50 p-6 md:p-8 border-l border-gray-200">
        <div class="sticky top-6 space-y-5">
          <div><span class="text-sm text-gray-500">Total Points</span><p id="total-points" class="text-4xl font-bold text-blue-600">0</p></div>
          <div><span class="text-sm text-gray-500">Classification</span><p id="ti-rads-level" class="text-3xl font-bold text-gray-800">TR1</p><p id="ti-rads-desc" class="text-lg text-gray-700">Benign</p></div>
          <div><span class="text-sm text-gray-500">Risk of Malignancy</span><p id="risk-level" class="text-lg font-semibold text-gray-700">0.3%</p></div>
          <hr />
          <div><h3 class="text-lg font-semibold text-gray-900">Management</h3>
            <div id="size-input-group" class="hidden mt-2">
              <label for="nodule-size" class="block text-sm text-gray-700 mb-1">Nodule Size (cm)</label>
              <input type="number" id="nodule-size" step="0.1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" />
            </div>
            <div id="recommendation-box" class="p-4 mt-3 rounded-lg bg-white border border-gray-200">
              <p id="recommendation-text" class="text-gray-800 font-medium">No FNA or follow-up required.</p>
              <p id="follow-up-text" class="text-sm text-gray-600 mt-1"></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center text-gray-500 text-xs mt-12 mb-6">
    © Plexura 2025 · <em>The Living Mind of Diagnostic Intelligence</em> · For educational use only.
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const groups = ["composition", "echogenicity", "shape", "margin"];
      const fociBoxes = document.querySelectorAll('input[name="foci"]');
      const sizeInput = document.getElementById("nodule-size");
      const resetButton = document.getElementById("reset-button");

      const totalPointsEl = document.getElementById("total-points");
      const tiRadsLevelEl = document.getElementById("ti-rads-level");
      const tiRadsDescEl = document.getElementById("ti-rads-desc");
      const riskLevelEl = document.getElementById("risk-level");
      const recText = document.getElementById("recommendation-text");
      const followUpText = document.getElementById("follow-up-text");
      const sizeInputGroup = document.getElementById("size-input-group");
      const recBox = document.getElementById("recommendation-box");

      const data = {
        TR1: { desc: "Benign", risk: "0.3%", fna: Infinity, follow: Infinity },
        TR2: { desc: "Not Suspicious", risk: "1.5%", fna: Infinity, follow: Infinity },
        TR3: { desc: "Mildly Suspicious", risk: "4.8%", fna: 2.5, follow: 1.5 },
        TR4: { desc: "Moderately Suspicious", risk: "9.1%", fna: 1.5, follow: 1.0 },
        TR5: { desc: "Highly Suspicious", risk: "35%", fna: 1.0, follow: 0.5 },
      };

      function calculate() {
        let points = 0;
        const compVal = parseInt(document.querySelector('input[name="composition"]:checked').value);
        const isBenign = compVal === 0 && (document.getElementById("comp-0").checked || document.getElementById("comp-1").checked);
        if (!isBenign) {
          groups.forEach((g) => (points += parseInt(document.querySelector(`input[name="${g}"]:checked`).value)));
          fociBoxes.forEach((b) => { if (b.checked && b.dataset.type === "point") points += parseInt(b.value); });
        }

        let level = "TR1";
        if (points >= 7) level = "TR5";
        else if (points >= 4) level = "TR4";
        else if (points === 3) level = "TR3";
        else if (points === 1 || points === 2) level = "TR2";

        update(points, level);
      }

      function update(points, key) {
        const d = data[key];
        totalPointsEl.textContent = points;
        tiRadsLevelEl.textContent = key;
        tiRadsDescEl.textContent = d.desc;
        riskLevelEl.textContent = d.risk;

        if (key === "TR1" || key === "TR2") {
          sizeInputGroup.classList.add("hidden");
          recText.textContent = "No FNA or follow-up required.";
          recBox.className = "p-4 rounded-lg bg-white border border-gray-200";
          followUpText.textContent = "";
        } else {
          sizeInputGroup.classList.remove("hidden");
          const s = parseFloat(sizeInput.value) || 0;
          if (s >= d.fna) {
            recText.textContent = `FNA recommended (≥${d.fna} cm)`;
            recBox.className = "p-4 rounded-lg bg-red-50 border border-red-200";
          } else if (s >= d.follow) {
            recText.textContent = `Follow-up recommended (≥${d.follow} cm)`;
            recBox.className = "p-4 rounded-lg bg-yellow-50 border border-yellow-200";
          } else {
            recText.textContent = `Below threshold for follow-up.`;
            recBox.className = "p-4 rounded-lg bg-blue-50 border border-blue-200";
          }
          followUpText.textContent = key === "TR5" ? "Annual follow-up up to 5 years." : "Follow-up at 1–5 years depending on risk.";
        }
      }

      document.getElementById("tirads-form").addEventListener("change", calculate);
      sizeInput.addEventListener("input", calculate);
      resetButton.addEventListener("click", () => { document.getElementById("tirads-form").reset(); calculate(); });
      calculate();
    });
  </script>
</body>
</html>
